name: Deploy PNW-MVP

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›ï¸ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ”‘ Set up Aleo private key
        run: echo "ALEO_PRIVATE_KEY=${{ secrets.ALEO_PRIVATE_KEY }}" >> $GITHUB_ENV

      - name: ğŸ› ï¸ Download & Install Custom Leo CLI (Tarball)
        run: |
          curl -L -o leo.tar.gz https://github.com/PNWBNW/pnw_mvp/releases/download/leo-2.4.1/leo-2.4.1.tar.gz
          mkdir -p $HOME/.aleo
          tar -xzf leo.tar.gz -C $HOME/.aleo
          chmod +x $HOME/.aleo/leo
          echo "export PATH=$HOME/.aleo:\$PATH" >> $GITHUB_ENV
          echo "export PATH=$HOME/.aleo:\$PATH" >> ~/.bashrc
          source $GITHUB_ENV

      - name: ğŸ” Verify Leo Installation
        run: |
          export PATH=$HOME/.aleo:$PATH
          leo --version

      - name: ğŸ” Set script permissions
        run: chmod +x deploy_pnw_mvp.sh

      - name: ğŸš€ Deploy PNW-MVP contracts
        run: |
          export PATH=$HOME/.aleo:$PATH
          ./deploy_pnw_mvp.sh
